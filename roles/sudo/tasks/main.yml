---
- name: install sudo
  become: yes
  become_method: su
  package:
    name: sudo
- name: "add {{ target_user }} to group sudo"
  become: yes
  become_method: su
  when: ansible_os_family == "Debian"
  user:
    append: yes
    name: "{{ target_user }}"
    groups:
      - sudo
- name: "add {{ target_user }} to group wheel"
  become: yes
  become_method: su
  when: ansible_os_family == "CentOS"
  user:
    name: "{{ target_user }}"
    append: yes
    groups:
      - wheel
- name: "edit /etc/sudoers to allow group sudo"
  become: yes
  become_method: su
  when: ansible_os_family == "Debian"
  replace:
    path: /etc/sudoers
    regexp: \%sudo[ ]*ALL=\(ALL:ALL\) ALL
    replace: "sudo    ALL=(ALL:ALL) ALL"
- meta: reset_connection
